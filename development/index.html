<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="viewport" content="initial-scale=1, width=device-width"/><meta name="generator" content="Gatsby 4.18.2"/><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css "></style><link rel="icon" href="/favicon-32x32.png?v=f465f8579753777f1f149153096a0e30" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=f465f8579753777f1f149153096a0e30"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=f465f8579753777f1f149153096a0e30"/><title data-react-helmet="true"></title><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"/><style>@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4.woff2) format("woff2")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:300;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/webfonts/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format("woff")}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/webfonts/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format("woff")}</style></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><title>网站开发</title><div class="jss1"><div><header class="MuiPaper-root MuiAppBar-root MuiAppBar-positionFixed MuiAppBar-colorInherit jss425 mui-fixed MuiPaper-elevation4"><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><div class="jss428 jss436"><button class="MuiButtonBase-root MuiIconButton-root jss426 MuiIconButton-colorInherit MuiIconButton-edgeStart" tabindex="0" type="button"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></span></button></div><div class="jss427 jss434"><h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-colorPrimary MuiTypography-noWrap"><a class="jss430" variant="inherit" href="/">生如夏花</a></h5></div><div class="jss434"><button class="MuiButtonBase-root MuiButton-root MuiButton-contained MuiButton-containedPrimary" tabindex="0" type="button"><span class="MuiButton-label">选择主题</span></button></div><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorPrimary" tabindex="0" aria-disabled="false" href="https://viva-la-vita.org" title="主页"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z"></path></svg></span></a><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorPrimary" tabindex="0" aria-disabled="false" href="https://bbs.viva-la-vita.org" title="论坛"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M20 6h-1v8c0 .55-.45 1-1 1H6v1c0 1.1.9 2 2 2h10l4 4V8c0-1.1-.9-2-2-2zm-3 5V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v13l4-4h9c1.1 0 2-.9 2-2z"></path></svg></span></a><a class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorPrimary" tabindex="0" aria-disabled="false" href="https://github.com/viva-la-vita/wiki" title="Github"><span class="MuiIconButton-label"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 .3a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2c-3.3.7-4-1.6-4-1.6-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.5 1 0-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.6.2 2.8 0 3.2.9.8 1.3 1.9 1.3 3.2 0 4.6-2.8 5.6-5.5 5.9.5.4.9 1 .9 2.2v3.3c0 .3.1.7.8.6A12 12 0 0 0 12 .3"></path></svg></span></a></div></header><nav class="jss422"><div class="jss436"></div><div class="jss434"><div class="MuiDrawer-root MuiDrawer-docked"><div class="MuiPaper-root MuiDrawer-paper jss423 MuiDrawer-paperAnchorLeft MuiDrawer-paperAnchorDockedLeft MuiPaper-elevation0"><div><div class="MuiToolbar-root MuiToolbar-regular MuiToolbar-gutters"><h5 class="MuiTypography-root MuiTypography-h5 MuiTypography-colorPrimary MuiTypography-noWrap"><a class="jss458" variant="inherit" href="/">生如夏花</a></h5></div><hr class="MuiDivider-root"/><div class="jss436"><a class="jss450 jss451" href="/nipple"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">乳首</div></a><a class="jss450 jss451" href="/prostate"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">前列腺</div></a><a aria-current="page" class="jss450 jss452" href="/development"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">网站开发</div></a><hr class="MuiDivider-root"/></div><hr class="MuiDivider-root"/><ul class="MuiList-root MuiList-padding"><a aria-current="page" class="jss450 jss452" href="/development"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">网站开发</div></a><a class="jss450 jss451" href="/development/home"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">主页</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/wiki"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">知识库</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/server"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">服务器</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/gateway"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">网关</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/cms-api"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">内容管理系统及 API</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/bbs"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">论坛</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/mail"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">邮件</div></a><ul class="MuiList-root MuiList-padding"></ul><a class="jss450 jss451" href="/development/backup"><div class="MuiButtonBase-root MuiListItem-root MuiListItem-gutters MuiListItem-button" tabindex="0" role="button" aria-disabled="false">备份</div></a><ul class="MuiList-root MuiList-padding"></ul></ul></div></div></div></div></nav></div><main class="jss459"><div class="jss460"></div><h2 class="MuiTypography-root MuiTypography-h2">网站开发</h2><span class="MuiTypography-root MuiTypography-body1 MuiTypography-paragraph"><h1>生如夏花网站开发之道</h1><p>欢迎您来到生如夏花网站开发文档！这里记录了生如夏花社区的各项服务背后的实现机制，供开发团队阅读与协作。</p><h2>开发团队的使命、愿景与价值观</h2><ul><li>使命：充分发挥技术的力量，为生如夏花社区提供优质的内容与交流平台</li><li>愿景：成为中文互联网世界中以各种不同的性体验的探索为主题的最大的线上社区</li><li>价值观：支持互联网的言论自由、交流创新与知识共享，反对互联网的资源过度集中化与内容审查</li></ul><h2>开发的基本原则</h2><ol><li>从开源中来，到开源中去：尽可能在开源软件的基础上进行二次开发，得到的代码和文档将以 GPLv3 和 CC-BY-SA 协议向世界开放；</li><li>如无必要，勿增实体：对于无法用开源软件自建的服务，使用尽可能少的外部供应商；</li><li>构建可维护可重用的微服务：把所有的服务拆分成一个个小的组件，每个组件用容器化（Docker）的方式开发及部署；</li></ol><h1>生如夏花各项服务简介</h1><h2>生如夏花主页</h2><ul><li>GitHub 仓库：<a href="https://github.com/viva-la-vita/viva-la-vita.github.io">https://github.com/viva-la-vita/viva-la-vita.github.io</a></li><li>部署位置：<a href="https://viva-la-vita.org">https://viva-la-vita.org</a></li></ul><p>主页负责引导用户访问社区的各个服务，以及展示社区的整体介绍。</p><h2>生如夏花知识库</h2><ul><li>GitHub 仓库：<a href="https://github.com/viva-la-vita/wiki">https://github.com/viva-la-vita/wiki</a></li><li>部署位置：<a href="https://wiki.viva-la-vita.org">https://wiki.viva-la-vita.org</a></li></ul><p>知识库负责拉取内容管理系统中的文档并构建前端页面，并部署在 GitHub Pages 上供社区成员访问。</p><h2>生如夏花网关</h2><ul><li>GitHub 仓库：<a href="https://github.com/viva-la-vita/gateway">https://github.com/viva-la-vita/gateway</a></li></ul><p>为节省计算资源，目前所有服务均部署在一台服务器上，但可以用不同的域名访问，所以需要用反向代理根据域名来转发到服务器上不同端口的各项服务；网关还同时负责管理由 Let&#x27;s Encrypt 颁发的 HTTPS SSL 证书，并且在反向代理的同时实现 SSL 加密和解密，这样各项服务就可以只实现 HTTP 的接口。</p><p>未来网关可能还会添加负载均衡功能。</p><h2>生如夏花内容管理系统及 API</h2><ul><li>GitHub 仓库：<a href="https://github.com/viva-la-vita/cms">https://github.com/viva-la-vita/cms</a></li><li>部署位置：<ul><li>内容管理系统：<a href="https://cms.viva-la-vita.org">https://cms.viva-la-vita.org</a></li><li>API：<a href="https://api.viva-la-vita.org">https://api.viva-la-vita.org</a></li></ul></li></ul><p>内容管理系统是一个可以供多人协同编辑文档的用户界面，它可以使得不具有技术背景的社区成员也可以参与文档的编辑。该系统中的内容可以通过一个统一的 API 进行访问，用于知识库前端页面的制作，也可以被其他开源项目集成。</p><h2>生如夏花论坛</h2><ul><li>GitHub 仓库：<a href="https://github.com/viva-la-vita/bbs">https://github.com/viva-la-vita/bbs</a></li><li>部署位置：<a href="https://bbs.viva-la-vita.org">https://bbs.viva-la-vita.org</a></li></ul><p>论坛用于社区成员的交流与分享。</p><h2>生如夏花邮箱</h2><ul><li>GitHub 仓库：<a href="https://github.com/viva-la-vita/mail">https://github.com/viva-la-vita/mail</a></li><li>部署位置：<a href="https://mail.viva-la-vita.org">https://mail.viva-la-vita.org</a></li></ul><p>邮箱用于论坛的注册及相关通知，以及供开发者注册各种其他帐号。</p><h1>生如夏花各项服务开发的基本流程</h1><h2>静态页面</h2><p>主页、知识库两个项目为纯静态网页，基于 Gatsby 静态网页生成器，其原理是将一个 React 应用首次渲染得到的静态文件上传到 GitHub Pages 的文件服务器上，然后配置自定义域名访问。</p><h3>本地开发</h3><p>首先在本地配置好 Node 16 (gallium) 的环境。将项目 clone 到本地，在根目录下运行 <code>npm i &amp;&amp; npm run develop</code>，编译好之后可以在 https://localhost:8000 访问；对本地源代码进行修改时网页会自动重载。</p><h3>自动构建和部署</h3><p>将代码提交到 master 分支时，GitHub Action 会对提交的代码运行 <code>npm ci &amp;&amp; npm run build</code>，并将生成的静态文件提交到 <code>gh-pages</code> 分支，该分支下的文件即对应相应域名访问的网页。</p><h2>动态页面</h2><p>其余项目为有后端的动态页面，每个项目都是由 Docker Compose 的配置文件定义的 Docker Compose 项目，包含一个或多个互相通信的容器。</p><h3>本地开发</h3><p>无需配置环境，下载对应平台的 Docker Desktop 后可以在项目根目录下运行</p><pre><code class="language-bash">docker compose up -d
</code></pre><p>根据服务的不同，在 localhost 的不同端口访问。为了更好地贴近生产环境，本地开发时也可以把网关在本地同时运行，然后用 SwitchHosts 等 <code>/etc/hosts</code> 文件修改器将 api, bbs, mail 等子域名的 IP 地址映射到 127.0.0.1，这样在浏览器中输入与服务实际存在的域名相同的地址即可调试本地开发的代码。</p><h3>自动构建</h3><p>将代码提交到 master 分支时，GitHub Actions 会对提交代码中定义的各个容器构建镜像，并且上传到 <code>ghcr.io</code> 的 docker registry 上。</p><h3>部署</h3><p>首先在<a href="https://wiki.viva-la-vita.org/development/server">服务器</a> 上配置好 docker 和 docker-compose，在本地的 <code>~/.ssh/config</code> 中配置好 Host 信息（假设 Host 名称为 vultr），然后在项目根目录下运行</p><pre><code class="language-bash">DOCKER_HOST=&quot;ssh://vultr&quot; docker compose -f docker-compose.yml up -d
</code></pre></span></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/development";window.___webpackCompilationHash="0e4f797401b9d9e57ad0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2214bbdca07847037d46.js"],"app":["/app-392b5053938e57b01452.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9716514e486958763655.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b763860feda8879a3bc3.js"],"component---src-templates-article-js":["/component---src-templates-article-js-62bce4a712faae2fdb41.js"]};/*]]>*/</script><script src="/polyfill-2214bbdca07847037d46.js" nomodule=""></script><script src="/app-392b5053938e57b01452.js" async=""></script><script src="/framework-055bdd453d9a5f7832ee.js" async=""></script><script src="/webpack-runtime-0e62246d839ab77e97ac.js" async=""></script></body></html>